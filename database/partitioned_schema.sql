-- 分区表示例（按时间分区）
-- 注意：需要 MySQL 5.7+ 支持
-- 使用前请备份数据！

-- 方案1：按时间分区（每月一个分区）
CREATE TABLE IF NOT EXISTS klines_1m_partitioned (
    id BIGINT AUTO_INCREMENT,
    symbol VARCHAR(20) NOT NULL COMMENT '交易对，如 BTC_USDT',
    open_time BIGINT NOT NULL COMMENT 'K线开盘时间（毫秒时间戳）',
    open DECIMAL(20, 8) NOT NULL COMMENT '开盘价',
    high DECIMAL(20, 8) NOT NULL COMMENT '最高价',
    low DECIMAL(20, 8) NOT NULL COMMENT '最低价',
    close DECIMAL(20, 8) NOT NULL COMMENT '收盘价',
    volume DECIMAL(20, 8) NOT NULL COMMENT '成交量',
    close_time BIGINT NOT NULL COMMENT 'K线收盘时间（毫秒时间戳）',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (id, open_time),
    UNIQUE KEY uk_symbol_time (symbol, open_time),
    INDEX idx_symbol_close_time (symbol, close_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
PARTITION BY RANGE (open_time) (
    PARTITION p202001 VALUES LESS THAN (1577836800000),  -- 2020-01-01
    PARTITION p202002 VALUES LESS THAN (1580515200000),  -- 2020-02-01
    PARTITION p202003 VALUES LESS THAN (1583020800000),  -- 2020-03-01
    PARTITION p202004 VALUES LESS THAN (1585699200000),  -- 2020-04-01
    PARTITION p202005 VALUES LESS THAN (1588291200000),  -- 2020-05-01
    PARTITION p202006 VALUES LESS THAN (1590969600000),  -- 2020-06-01
    PARTITION p202007 VALUES LESS THAN (1593561600000),  -- 2020-07-01
    PARTITION p202008 VALUES LESS THAN (1596240000000),  -- 2020-08-01
    PARTITION p202009 VALUES LESS THAN (1598918400000),  -- 2020-09-01
    PARTITION p202010 VALUES LESS THAN (1601510400000),  -- 2020-10-01
    PARTITION p202011 VALUES LESS THAN (1604102400000),  -- 2020-11-01
    PARTITION p202012 VALUES LESS THAN (1606780800000),  -- 2020-12-01
    PARTITION p202101 VALUES LESS THAN (1609459200000),  -- 2021-01-01
    PARTITION p202102 VALUES LESS THAN (1612137600000),  -- 2021-02-01
    PARTITION p202103 VALUES LESS THAN (1614556800000),  -- 2021-03-01
    PARTITION p202104 VALUES LESS THAN (1617235200000),  -- 2021-04-01
    PARTITION p202105 VALUES LESS THAN (1619827200000),  -- 2021-05-01
    PARTITION p202106 VALUES LESS THAN (1622505600000),  -- 2021-06-01
    PARTITION p202107 VALUES LESS THAN (1625097600000),  -- 2021-07-01
    PARTITION p202108 VALUES LESS THAN (1627776000000),  -- 2021-08-01
    PARTITION p202109 VALUES LESS THAN (1630454400000),  -- 2021-09-01
    PARTITION p202110 VALUES LESS THAN (1633046400000),  -- 2021-10-01
    PARTITION p202111 VALUES LESS THAN (1635724800000),  -- 2021-11-01
    PARTITION p202112 VALUES LESS THAN (1638316800000),  -- 2021-12-01
    PARTITION p202201 VALUES LESS THAN (1640995200000),  -- 2022-01-01
    PARTITION p202202 VALUES LESS THAN (1643673600000),  -- 2022-02-01
    PARTITION p202203 VALUES LESS THAN (1646092800000),  -- 2022-03-01
    PARTITION p202204 VALUES LESS THAN (1648771200000),  -- 2022-04-01
    PARTITION p202205 VALUES LESS THAN (1651363200000),  -- 2022-05-01
    PARTITION p202206 VALUES LESS THAN (1654041600000),  -- 2022-06-01
    PARTITION p202207 VALUES LESS THAN (1656633600000),  -- 2022-07-01
    PARTITION p202208 VALUES LESS THAN (1659312000000),  -- 2022-08-01
    PARTITION p202209 VALUES LESS THAN (1661990400000),  -- 2022-09-01
    PARTITION p202210 VALUES LESS THAN (1664582400000),  -- 2022-10-01
    PARTITION p202211 VALUES LESS THAN (1667260800000),  -- 2022-11-01
    PARTITION p202212 VALUES LESS THAN (1669852800000),  -- 2022-12-01
    PARTITION p202301 VALUES LESS THAN (1672531200000),  -- 2023-01-01
    PARTITION p202302 VALUES LESS THAN (1675209600000),  -- 2023-02-01
    PARTITION p202303 VALUES LESS THAN (1677628800000),  -- 2023-03-01
    PARTITION p202304 VALUES LESS THAN (1680307200000),  -- 2023-04-01
    PARTITION p202305 VALUES LESS THAN (1682899200000),  -- 2023-05-01
    PARTITION p202306 VALUES LESS THAN (1685577600000),  -- 2023-06-01
    PARTITION p202307 VALUES LESS THAN (1688169600000),  -- 2023-07-01
    PARTITION p202308 VALUES LESS THAN (1690848000000),  -- 2023-08-01
    PARTITION p202309 VALUES LESS THAN (1693526400000),  -- 2023-09-01
    PARTITION p202310 VALUES LESS THAN (1696118400000),  -- 2023-10-01
    PARTITION p202311 VALUES LESS THAN (1698796800000),  -- 2023-11-01
    PARTITION p202312 VALUES LESS THAN (1701388800000),  -- 2023-12-01
    PARTITION p202401 VALUES LESS THAN (1704067200000),  -- 2024-01-01
    PARTITION p202402 VALUES LESS THAN (1706745600000),  -- 2024-02-01
    PARTITION p202403 VALUES LESS THAN (1709251200000),  -- 2024-03-01
    PARTITION p202404 VALUES LESS THAN (1711929600000),  -- 2024-04-01
    PARTITION p202405 VALUES LESS THAN (1714521600000),  -- 2024-05-01
    PARTITION p202406 VALUES LESS THAN (1717200000000),  -- 2024-06-01
    PARTITION p202407 VALUES LESS THAN (1719792000000),  -- 2024-07-01
    PARTITION p202408 VALUES LESS THAN (1722470400000),  -- 2024-08-01
    PARTITION p202409 VALUES LESS THAN (1725148800000),  -- 2024-09-01
    PARTITION p202410 VALUES LESS THAN (1727740800000),  -- 2024-10-01
    PARTITION p202411 VALUES LESS THAN (1730419200000),  -- 2024-11-01
    PARTITION p202412 VALUES LESS THAN (1733011200000),  -- 2024-12-01
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- 方案2：按币种哈希分区（适合币种数量多的情况）
-- CREATE TABLE IF NOT EXISTS klines_1m_hash_partitioned (
--     id BIGINT AUTO_INCREMENT,
--     symbol VARCHAR(20) NOT NULL,
--     open_time BIGINT NOT NULL,
--     -- ... 其他字段
--     PRIMARY KEY (id, symbol),
--     UNIQUE KEY uk_symbol_time (symbol, open_time),
--     INDEX idx_symbol_close_time (symbol, close_time)
-- ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
-- PARTITION BY HASH(CRC32(symbol)) PARTITIONS 16;

